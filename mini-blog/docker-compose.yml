services:
  posts:
    build:
      context: ./posts
      dockerfile: Dockerfile
    image: mini-blog-posts:latest
    ports:
      - "4000:3000"
    environment:
      - EVENT_BUS_API_URL=http://event-bus:3000
    depends_on:
      - event-bus
    networks:
      - microservices
    labels:
      - "service=posts"
  event-bus:
    build:
      context: ./event-bus
      dockerfile: Dockerfile
    image: mini-blog-event-bus:latest
    ports:
      - "4005:3000"
    environment:
      - POSTS_API_URL=http://posts:3000
      - COMMENTS_API_URL=http://comments:3000
      - QUERY_API_URL=http://query:3000
      - MODERATION_API_URL=http://moderation:3000
    networks:
      - microservices
    labels:
      - "service=event-bus"
  query:
    build:
      context: ./query
      dockerfile: Dockerfile
    image: mini-blog-query:latest
    ports:
      - "4002:3000"
    environment:
      - EVENT_BUS_API_URL=http://event-bus:3000
    depends_on:
      - event-bus
    networks:
      - microservices
    labels:
      - "service=query"
  comments:
    build:
      context: ./comments
      dockerfile: Dockerfile
    image: mini-blog-comments:latest
    ports:
      - "4001:3000"
    environment:
      - EVENT_BUS_API_URL=http://event-bus:3000
    depends_on:
      - event-bus
    networks:
      - microservices
    labels:
      - "service=comments"
  moderation:
    build:
      context: ./moderation
      dockerfile: Dockerfile
    image: mini-blog-moderation:latest
    ports:
      - "4003:3000"
    environment:
      - EVENT_BUS_API_URL=http://event-bus:3000
    depends_on:
      - event-bus
    networks:
      - microservices
    labels:
      - "service=moderation"

networks:
  microservices:
    driver: bridge
